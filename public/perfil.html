<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil - Sistema de Ramais</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="perfil.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="back-button" onclick="goToDashboard()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                </svg>
                Ramais Virtuais
            </div>
        </div>
        <img id="headerAvatar" class="user-avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%233b82f6'/%3E%3Ctext x='50' y='50' font-family='Arial' font-size='40' fill='white' text-anchor='middle' dominant-baseline='central'%3EU%3C/text%3E%3C/svg%3E" alt="Avatar">
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar Menu -->
        <aside class="sidebar">
            <div class="menu-title">Configurações</div>
            <div class="menu-item active" data-section="personal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span>Informações Pessoais</span>
            </div>
            <div class="menu-item" data-section="security">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <span>Privacidade e Segurança</span>
            </div>
            <div class="menu-item" data-section="customization">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                <span>Personalização</span>
            </div>
            <div class="menu-item" data-section="company">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>Ramal e Empresa</span>
            </div>
        </aside>

        <!-- Content Area -->
        <main class="content">
            <!-- Personal Information Section -->
            <section id="personal" class="content-section active">
                <div class="card">
                    <h2 class="card-title">Informações Pessoais</h2>
                    <p class="card-subtitle">Gerencie suas informações básicas e foto de perfil</p>

                    <div class="profile-photo-section">
                        <img id="profilePhotoPreview" class="profile-photo-preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%233b82f6'/%3E%3Ctext x='50' y='50' font-family='Arial' font-size='40' fill='white' text-anchor='middle' dominant-baseline='central'%3EU%3C/text%3E%3C/svg%3E" alt="Foto de perfil">
                        <div>
                            <h3 style="margin-bottom: 0.5rem;">Foto do perfil</h3>
                            <p style="color: #64748b; font-size: 0.875rem; margin-bottom: 1rem;">JPG, PNG ou SVG. Máximo 2MB.</p>
                            <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                            <button class="upload-button" onclick="document.getElementById('photoUpload').click()">Alterar Foto</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Nome Completo</label>
                        <input type="text" id="fullName" class="form-input" placeholder="Digite seu nome completo">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="email" class="form-input" placeholder="seu.email@empresa.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="tel" id="phone" class="form-input" placeholder="(00) 00000-0000">
                    </div>

                    <button class="save-button" onclick="savePersonalInfo()">Salvar Alterações</button>
                </div>
            </section>

            <!-- Security Section -->
            <section id="security" class="content-section">
                <div class="card">
                    <h2 class="card-title">Privacidade e Segurança</h2>
                    <p class="card-subtitle">Proteja sua conta com senha forte e autenticação em dois fatores</p>

                    <div class="form-group">
                        <label class="form-label">Senha Atual</label>
                        <input type="password" id="currentPassword" class="form-input" placeholder="Digite sua senha atual">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Nova Senha</label>
                        <input type="password" id="newPassword" class="form-input" placeholder="Digite sua nova senha">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirmar Nova Senha</label>
                        <input type="password" id="confirmPassword" class="form-input" placeholder="Confirme sua nova senha">
                    </div>

                    <div class="toggle-switch">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Autenticação em Dois Fatores</div>
                            <div style="font-size: 0.875rem; color: #64748b;">Adicione uma camada extra de segurança</div>
                        </div>
                        <div class="switch" id="twoFactorSwitch" onclick="toggleSwitch('twoFactorSwitch')">
                            <div class="switch-slider"></div>
                        </div>
                    </div>

                    <button class="save-button" onclick="saveSecuritySettings()">Atualizar Segurança</button>
                </div>
            </section>

            <!-- Customization Section -->
            <section id="customization" class="content-section">
                <div class="card">
                    <h2 class="card-title">Personalização</h2>
                    <p class="card-subtitle">Customize a aparência do sistema de acordo com suas preferências</p>

                    <div class="form-group">
                        <label class="form-label">Tema de Cor</label>
                        <div class="theme-options">
                            <div class="theme-option selected" data-theme="blue" onclick="selectTheme('blue')">
                                <div class="theme-color" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"></div>
                                <div>Azul Padrão</div>
                            </div>
                            <div class="theme-option" data-theme="dark" onclick="selectTheme('dark')">
                                <div class="theme-color" style="background: linear-gradient(135deg, #1e293b, #0f172a);"></div>
                                <div>Escuro</div>
                            </div>
                            <div class="theme-option" data-theme="light" onclick="selectTheme('light')">
                                <div class="theme-color" style="background: linear-gradient(135deg, #ffffff, #f1f5f9);"></div>
                                <div>Branco Puro</div>
                            </div>
                        </div>
                    </div>

                    <div class="toggle-switch">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Modo Escuro</div>
                            <div style="font-size: 0.875rem; color: #64748b;">Ative o tema escuro para reduzir cansaço visual</div>
                        </div>
                        <div class="switch" id="darkModeSwitch" onclick="toggleDarkMode()">
                            <div class="switch-slider"></div>
                        </div>
                    </div>

                    <button class="save-button" onclick="saveCustomization()">Salvar Preferências</button>
                </div>
            </section>

            <!-- Company Section -->
            <section id="company" class="content-section">
                <div class="card">
                    <h2 class="card-title">Ramal e Empresa</h2>
                    <p class="card-subtitle">Informações do seu ramal e dados empresariais</p>

                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: #334155;">Meu Ramal</h3>

                    <div class="info-row">
                        <span class="info-label">Número do Ramal</span>
                        <span class="info-value" id="displayRamal">1234</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Editar Ramal</label>
                        <input type="text" id="ramalNumber" class="form-input" placeholder="Digite o número do ramal">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cargo</label>
                        <input type="text" id="position" class="form-input" placeholder="Ex: Gerente de Vendas">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Departamento</label>
                        <input type="text" id="department" class="form-input" placeholder="Ex: Comercial">
                    </div>

                    <h3 style="font-size: 1.125rem; font-weight: 600; margin: 2rem 0 1rem; color: #334155;">Informações Empresariais</h3>

                    <div class="form-group">
                        <label class="form-label">Nome da Empresa</label>
                        <input type="text" id="companyName" class="form-input" placeholder="Digite o nome da empresa">
                    </div>

                    <div class="form-group">
                        <label class="form-label">CNPJ</label>
                        <input type="text" id="cnpj" class="form-input" placeholder="00.000.000/0000-00">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Endereço</label>
                        <input type="text" id="address" class="form-input" placeholder="Rua, número, bairro, cidade">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Domínio Corporativo</label>
                        <input type="text" id="domain" class="form-input" placeholder="@empresa.com.br">
                    </div>

                    <button class="save-button" onclick="saveCompanyInfo()">Salvar Informações Empresariais</button>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Função para obter a chave do usuário atual
        function getUserKey(key) {
            const currentUser = localStorage.getItem('currentUser');
            return currentUser ? `${currentUser}_${key}` : key;
        }

        // Identificar usuário ao carregar
        function identifyUser() {
            const session = localStorage.getItem('cloudpbx_session');
            if (session) {
                const userData = JSON.parse(session);
                const userIdentifier = userData.email || userData.nome.replace(/\s+/g, '_').toLowerCase();
                localStorage.setItem('currentUser', userIdentifier);
            }
        }

        // Initialize data from localStorage
        function loadProfileData() {
            const profile = JSON.parse(localStorage.getItem(getUserKey('userProfile'))) || {};
            
            // Personal Info
            document.getElementById('fullName').value = profile.fullName || '';
            document.getElementById('email').value = profile.email || '';
            document.getElementById('phone').value = profile.phone || '';
            
            // Photo
            const photoUrl = localStorage.getItem(getUserKey('userPhoto'));
            if (photoUrl) {
                document.getElementById('profilePhotoPreview').src = photoUrl;
                document.getElementById('headerAvatar').src = photoUrl;
            }

            // Security
            const twoFactor = localStorage.getItem(getUserKey('twoFactorEnabled')) === 'true';
            if (twoFactor) {
                document.getElementById('twoFactorSwitch').classList.add('active');
            }

            // Customization
            const theme = localStorage.getItem(getUserKey('colorTheme')) || 'blue';
            selectTheme(theme);
            
            const darkMode = localStorage.getItem(getUserKey('darkMode')) === 'true';
            if (darkMode) {
                document.getElementById('darkModeSwitch').classList.add('active');
                applyDarkMode(true);
            } else {
                applyTheme(theme);
            }

            // Company
            document.getElementById('ramalNumber').value = profile.ramal || '';
            document.getElementById('displayRamal').textContent = profile.ramal || '----';
            document.getElementById('position').value = profile.position || '';
            document.getElementById('department').value = profile.department || '';
            document.getElementById('companyName').value = profile.companyName || '';
            document.getElementById('cnpj').value = profile.cnpj || '';
            document.getElementById('address').value = profile.address || '';
            document.getElementById('domain').value = profile.domain || '';
        }

        // Navigation
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                const section = this.getAttribute('data-section');
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                document.getElementById(section).classList.add('active');
            });
        });

        // Photo Upload
        document.getElementById('photoUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.size <= 2000000) { // 2MB limit
                const reader = new FileReader();
                reader.onload = function(event) {
                    const photoUrl = event.target.result;
                    document.getElementById('profilePhotoPreview').src = photoUrl;
                    document.getElementById('headerAvatar').src = photoUrl;
                    localStorage.setItem(getUserKey('userPhoto'), photoUrl);
                    showNotification('Foto atualizada com sucesso!');
                };
                reader.readAsDataURL(file);
            } else {
                alert('Arquivo muito grande. Máximo 2MB.');
            }
        });

        // Save Functions
        function savePersonalInfo() {
            const profile = JSON.parse(localStorage.getItem(getUserKey('userProfile'))) || {};
            profile.fullName = document.getElementById('fullName').value;
            profile.email = document.getElementById('email').value;
            profile.phone = document.getElementById('phone').value;
            
            localStorage.setItem(getUserKey('userProfile'), JSON.stringify(profile));
            showNotification('Informações pessoais salvas com sucesso!');
        }

        function saveSecuritySettings() {
            const currentPass = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;

            if (newPass && newPass !== confirmPass) {
                alert('As senhas não coincidem!');
                return;
            }

            const twoFactorEnabled = document.getElementById('twoFactorSwitch').classList.contains('active');
            localStorage.setItem(getUserKey('twoFactorEnabled'), twoFactorEnabled);

            if (newPass) {
                localStorage.setItem(getUserKey('userPassword'), newPass);
            }

            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            showNotification('Configurações de segurança atualizadas!');
        }

        function saveCustomization() {
            const darkMode = document.getElementById('darkModeSwitch').classList.contains('active');
            localStorage.setItem(getUserKey('darkMode'), darkMode);
            
            showNotification('Preferências de personalização salvas!');
        }

        function saveCompanyInfo() {
            const profile = JSON.parse(localStorage.getItem(getUserKey('userProfile'))) || {};
            profile.ramal = document.getElementById('ramalNumber').value;
            profile.position = document.getElementById('position').value;
            profile.department = document.getElementById('department').value;
            profile.companyName = document.getElementById('companyName').value;
            profile.cnpj = document.getElementById('cnpj').value;
            profile.address = document.getElementById('address').value;
            profile.domain = document.getElementById('domain').value;
            
            localStorage.setItem(getUserKey('userProfile'), JSON.stringify(profile));
            document.getElementById('displayRamal').textContent = profile.ramal || '----';
            showNotification('Informações empresariais salvas com sucesso!');
        }

        // Toggle Switch
        function toggleSwitch(id) {
            const switchEl = document.getElementById(id);
            switchEl.classList.toggle('active');
        }

        // Toggle Dark Mode
        function toggleDarkMode() {
            const switchEl = document.getElementById('darkModeSwitch');
            const isActive = switchEl.classList.contains('active');
            
            if (isActive) {
                switchEl.classList.remove('active');
                applyDarkMode(false);
                localStorage.setItem(getUserKey('darkMode'), 'false');
            } else {
                switchEl.classList.add('active');
                applyDarkMode(true);
                localStorage.setItem(getUserKey('darkMode'), 'true');
            }
            
            showNotification('Modo escuro ' + (isActive ? 'desativado' : 'ativado') + '!');
        }

        // Aplicar modo escuro
        function applyDarkMode(enabled) {
            if (enabled) {
                document.body.classList.add('dark-theme');
                document.body.classList.remove('light-theme', 'blue-theme');
            } else {
                // Aplicar o tema de cor atual
                const theme = localStorage.getItem(getUserKey('colorTheme')) || 'blue';
                document.body.classList.remove('dark-theme');
                document.body.classList.add(`${theme}-theme`);
            }
        }

        // Theme Selection
        function selectTheme(theme) {
            document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-theme="${theme}"]`).classList.add('selected');
            localStorage.setItem(getUserKey('colorTheme'), theme);
            
            // Aplicar o tema imediatamente (se não estiver no modo escuro)
            const darkMode = localStorage.getItem(getUserKey('darkMode')) === 'true';
            if (!darkMode) {
                applyTheme(theme);
            }
        }

        // Função para aplicar o tema
        function applyTheme(theme) {
            document.body.className = ''; // Reset classes
            document.body.classList.add(`${theme}-theme`);
        }

        // Navigation
        function goToDashboard() {
            window.location.href = 'dashboard.html';
        }

        // Notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 2rem;
                background: #10b981;
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                font-weight: 600;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Inicializar
        window.addEventListener('DOMContentLoaded', function() {
            identifyUser();
            loadProfileData();
        });
    </script>
</body>
</html>